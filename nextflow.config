params.runtime_opts = ""
params.lsf_opts = ""

includeConfig 'external-modules/spark/nextflow.config'

manifest {
    defaultBranch = "main"
    description = "Demos of using Nextflow for imagery pipelines"
    version = "1.0.0"
}

profiles {
  
    debug { 
        process.beforeScript = 'echo $HOSTNAME' 
    }

    standard {
        docker.enabled = false
        singularity.enabled = true
    }

    aws {
        docker.enabled = true
        singularity.enabled = false
        aws {
            batch.cliPath = '/home/ec2-user/miniconda/bin/aws'
        }
        process {
            executor = 'awsbatch'
            queue = 'janelia-nextflow-tower-connect'
        }
    }

    tower {
        docker.enabled = true
        singularity.enabled = false
        aws {
            batch.cliPath = '/home/ec2-user/miniconda/bin/aws'
        }
    }

    lsf {
        process {
            executor = 'lsf'
            clusterOptions = params.lsf_opts
        }
        docker.enabled = false
        singularity.enabled = true
    }
}

executor {
    queueSize = 1000
    pollInterval = "2 sec"
    //queueStatInterval = "6 sec"
}

docker {
    temp = "auto"
    runOptions = "${params.runtime_opts}"
}

singularity {
    autoMounts = true
    cacheDir = "$HOME/.singularity_cache"
    runOptions = "${params.runtime_opts}"
}

